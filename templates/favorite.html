<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Vokabeln</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

  <style>
    .search-bar {
      max-width: 400px;
      position: relative;
    }

    .input-group-text {
      background-color: #e9ecef;
    }

    #suggestionBox {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      z-index: 10;
    }

    #suggestionBox .list-group-item {
      cursor: pointer;
      padding: 0.5rem 1rem;
      display: flex;
      align-items: center;
    }

    #suggestionBox .list-group-item:hover {
      background-color: #f1f1f1;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h2><i class="bi bi-list-stars"></i> Navigation</h2>
    <ul>
      <li><a href="/" ><i class="bi bi-house-door-fill"></i> Home</a></li>
      <li><a href="/favorite" class="active"><i class="bi bi-star-fill"></i> Vokabeln</a></li>
      <li><a href="/quiz"><i class="bi bi-patch-question-fill"></i> Vokabeltest</a></li>
      <li><a href="/dashboard"><i class="bi bi-bar-chart-line-fill"></i> Dashboard</a></li>
    </ul>
</div>
  

  <!-- Hauptinhalt -->
  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-3">
      <h1><i class="bi bi-bookmark-check-fill"></i> Gespeicherte Vokabeln</h1>

      <div class="d-flex gap-2 flex-wrap">
        <!-- Sprachfilter -->
        <select class="form-select" id="languageFilter" onchange="loadVocab()">
          <option value="">ğŸŒ Alle Sprachen</option>
          <option value="en">ğŸ‡¬ğŸ‡§ Englisch</option>
          <option value="fr">ğŸ‡«ğŸ‡· FranzÃ¶sisch</option>
          <option value="es">ğŸ‡ªğŸ‡¸ Spanisch</option>
          <option value="ja">ğŸ‡¯ğŸ‡µ Japanisch</option>
          <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
        </select>

        <!-- Alle lÃ¶schen -->
        <button class="btn btn-danger" onclick="deleteAllVocab()">
          <i class="bi bi-trash3-fill"></i> Alle lÃ¶schen
        </button>
      </div>
    </div>

    <!-- Suchleiste mit VorschlÃ¤gen -->
    <div class="input-group mb-3 search-bar">
      <span class="input-group-text"><i class="bi bi-search"></i></span>
      <input type="text" class="form-control" placeholder="ğŸ” Nach Wort oder Satz suchen..." id="searchInput" oninput="handleSearchInput()" autocomplete="off" />
      <div id="suggestionBox" class="list-group"></div>
    </div>

    <!-- Vokabelliste -->
    <ul id="vocabList" class="list-group"></ul>
  </div>

  <!-- JavaScript -->
  <script>
    function handleSearchInput() {
      fetchSuggestions();
      loadVocab();
    }

    function fetchSuggestions() {
      const query = document.getElementById("searchInput").value.trim();
      const suggestionBox = document.getElementById("suggestionBox");

      if (query.length < 2) {
        suggestionBox.innerHTML = "";
        return;
      }

      fetch(`http://127.0.0.1:5000/suggest-vocab?q=${encodeURIComponent(query)}`)
        .then(res => res.json())
        .then(suggestions => {
          suggestionBox.innerHTML = "";
          suggestions.forEach(text => {
            const item = document.createElement("div");
            item.className = "list-group-item";
            item.innerHTML = `<i class="bi bi-search text-muted me-2"></i> ${text}`;
            item.onclick = () => {
              document.getElementById("searchInput").value = text;
              suggestionBox.innerHTML = "";
              loadVocab();
            };
            suggestionBox.appendChild(item);
          });
        });
    }

    function loadVocab() {
      const query = document.getElementById("searchInput").value.trim();
      const lang = document.getElementById("languageFilter").value;

      let url = query
        ? `http://127.0.0.1:5000/search-vocab?q=${encodeURIComponent(query)}&lang=${encodeURIComponent(lang)}`
        : `http://127.0.0.1:5000/get-vocab-by-lang?lang=${encodeURIComponent(lang)}`;

      fetch(url)
        .then(res => res.json())
        .then(data => {
          renderVocabList(data);
        });
    }

    function renderVocabList(data) {
      const list = document.getElementById("vocabList");
      list.innerHTML = "";

      if (data.length === 0) {
        list.innerHTML = '<li class="list-group-item text-muted">ğŸ” Keine passenden Vokabeln gefunden.</li>';
        return;
      }

      data.forEach(entry => {
        const item = document.createElement("li");
        item.className = "list-group-item";
        item.innerHTML = 
          `<div class="d-flex justify-content-between align-items-start">
            <div>
              <h5 class="mb-1"><b>${entry.original_word}</b> â†’ ${entry.translated_word}</h5>
              <p class="mb-1 text-muted">${entry.original_sentence}</p>
            </div>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteVocab(${entry.id}, this)" title="LÃ¶schen">
              <i class="bi bi-trash"></i>
            </button>
          </div>`;
        list.appendChild(item);
      });
    }

    function deleteVocab(id, button) {
      if (!confirm("Diese Vokabel wirklich lÃ¶schen?")) return;

      fetch(`http://127.0.0.1:5000/delete-vocab/${id}`, { method: "DELETE" })
        .then(res => res.json())
        .then(data => {
          if (data.status === "success") {
            const listItem = button.closest("li");
            if (listItem) listItem.remove();
          } else {
            alert("âŒ Fehler beim LÃ¶schen: " + data.message);
          }
        })
        .catch(err => {
          alert("âŒ Netzwerkfehler beim LÃ¶schen.");
          console.error(err);
        });
    }

    function deleteAllVocab() {
      if (!confirm("âš ï¸ MÃ¶chtest du wirklich alle Vokabeln lÃ¶schen?")) return;

      fetch("http://127.0.0.1:5000/delete-all-vocab", { method: "DELETE" })
        .then(res => res.json())
        .then(data => {
          if (data.status === "success") {
            document.getElementById("vocabList").innerHTML = "";
            alert("âœ… Alle Vokabeln wurden gelÃ¶scht.");
          } else {
            alert("âŒ Fehler: " + data.message);
          }
        })
        .catch(err => {
          alert("âŒ Netzwerkfehler beim LÃ¶schen.");
          console.error(err);
        });
    }

    // Initial
    loadVocab();
  </script>
</body>
</html>
