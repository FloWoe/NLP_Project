<!-- templates/layout.html -->
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <!-- Der Titel wird von den erbenden Templates gesetzt -->
    <title>{% block title %}Vokabeltrainer{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Link zu deiner globalen styles.css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Zusätzliche Styles von spezifischen Seiten -->
    {% block head_styles %}{% endblock %}
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <ul>
            <li>
                <a href="#" id="toggleSidebar" class="nav-link">
                    <i class="bi bi-list toggle-btn"></i> <span class="sidebar-text">Navigation</span>
                </a>
            </li>
            <li><a href="{{ url_for('index') }}" class="{{ 'active' if request.endpoint == 'index' else '' }}"><i class="bi bi-house-door-fill"></i> <span class="sidebar-text">Home</span></a></li>
            
            {% if current_user.is_authenticated %}
                <li><a href="{{ url_for('favorite') }}" class="{{ 'active' if request.endpoint == 'favorite' else '' }}"><i class="bi bi-star-fill"></i> <span class="sidebar-text">Vokabeln</span></a></li>
                <li><a href="{{ url_for('quiz_page') }}" class="{{ 'active' if request.endpoint == 'quiz_page' else '' }}"><i class="bi bi-patch-question-fill"></i> <span class="sidebar-text">Vokabeltest</span></a></li>
                <li><a href="{{ url_for('lernen') }}" class="{{ 'active' if request.endpoint == 'lernen' else '' }}"><i class="bi bi-book-half"></i> <span class="sidebar-text">Lernen</span></a></li>
                <li><a href="{{ url_for('dashboard') }}" class="{{ 'active' if request.endpoint == 'dashboard' else '' }}"><i class="bi bi-bar-chart-line-fill"></i> <span class="sidebar-text">Dashboard</span></a></li>
            {% endif %}
            
            <li><a href="{{ url_for('hilfe') }}" class="{{ 'active' if request.endpoint == 'hilfe' else '' }}"><i class="bi bi-info-circle-fill"></i> <span class="sidebar-text">Hilfe</span></a></li>

            <!-- Login/Logout Bereich -->
            <li class="mt-auto pt-3 border-top sidebar-bottom-links"> <!-- Klasse für Styling unten -->
            {% if current_user.is_authenticated %}
                <a href="#" class="disabled-link"><i class="bi bi-person-fill"></i> <span class="sidebar-text">{{ current_user.username }}</span></a>
                <a href="{{ url_for('logout') }}" id="logoutButton"><i class="bi bi-box-arrow-right"></i> <span class="sidebar-text">Logout</span></a>
            {% else %}
                <a href="{{ url_for('login') }}"><i class="bi bi-box-arrow-in-right"></i> <span class="sidebar-text">Login</span></a>
                <a href="{{ url_for('register') }}"><i class="bi bi-person-plus-fill"></i> <span class="sidebar-text">Registrieren</span></a>
            {% endif %}
            </li>
        </ul>
    </div>

    <!-- Hauptinhalt wird von den erbenden Templates gefüllt -->
    <div class="main-content-wrapper" id="mainContentWrapper"> <!-- Wrapper für Verschiebung -->
        {% block content %}{% endblock %}
    </div>

    <!-- Globale Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Sidebar Toggle Script (nur einmal hier) -->
    <script>
        const toggleBtn = document.getElementById('toggleSidebar');
        const sidebar = document.getElementById('sidebar');
        const mainContentWrapper = document.getElementById('mainContentWrapper'); // Angepasst
        const sidebarTexts = document.querySelectorAll('.sidebar-text'); // Alle Texte in der Sidebar

        function applySidebarState() {
            if (localStorage.getItem('sidebarCollapsed') === 'true') {
                sidebar.classList.add('collapsed');
                if (mainContentWrapper) mainContentWrapper.classList.add('collapsed');
                sidebarTexts.forEach(span => span.style.display = 'none'); // Texte ausblenden
            } else {
                sidebar.classList.remove('collapsed');
                if (mainContentWrapper) mainContentWrapper.classList.remove('collapsed');
                sidebarTexts.forEach(span => span.style.display = 'inline'); // Texte einblenden
            }
        }

        // Zustand beim Laden wiederherstellen
        applySidebarState();

        if (toggleBtn) {
            toggleBtn.addEventListener('click', function (e) {
                e.preventDefault();
                sidebar.classList.toggle('collapsed');
                if (mainContentWrapper) mainContentWrapper.classList.toggle('collapsed');
                
                const isCollapsed = sidebar.classList.contains('collapsed');
                localStorage.setItem('sidebarCollapsed', isCollapsed);
                sidebarTexts.forEach(span => span.style.display = isCollapsed ? 'none' : 'inline');
            });
        }

        // Logout-Handling (optional, wenn du AJAX-Logout willst)
        const logoutButton = document.getElementById('logoutButton');
        if (logoutButton) {
            logoutButton.addEventListener('click', function(event) {
                event.preventDefault(); 
                fetch("{{ url_for('logout') }}")
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            // alert(data.message); // Optional
                            window.location.href = "{{ url_for('login') }}"; 
                        } else {
                            alert('Logout fehlgeschlagen.');
                        }
                    })
                    .catch(error => {
                        console.error('Logout-Fehler:', error);
                        alert('Fehler beim Logout.');
                    });
            });
        }
    </script>
    
    <!-- Zusätzliche Scripts von spezifischen Seiten -->
    {% block scripts %}{% endblock %}
</body>
</html>